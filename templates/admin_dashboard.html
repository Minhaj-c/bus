{% extends 'base.html' %}

{% block content %}
<h1>üìä Admin Dashboard</h1>
<p>Weekly Performance Summary for Week Starting: <strong>{{ week_start|date:"M d, Y" }}</strong></p>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div class="card" style="background-color: #e6ffe6;">
        <h3>Total Profit</h3>
        <p style="font-size: 24px; font-weight: bold;">‚Çπ{{ total_profit|floatformat:2 }}</p>
    </div>
    <div class="card" style="background-color: #e6f7ff;">
        <h3>Total Revenue</h3>
        <p style="font-size: 24px; font-weight: bold;">‚Çπ{{ total_revenue|floatformat:2 }}</p>
    </div>
    <div class="card" style="background-color: #ffe6e6;">
        <h3>Total Cost</h3>
        <p style="font-size: 24px; font-weight: bold;">‚Çπ{{ total_cost|floatformat:2 }}</p>
    </div>
    <div class="card" style="background-color: #f0e6ff;">
        <h3>Total Passengers</h3>
        <p style="font-size: 24px; font-weight: bold;">{{ total_passengers }}</p>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
    <!-- Top Routes -->
    <div class="card">
        <h2>üèÜ Top Performing Routes</h2>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="background-color: #f5f5f5;">
                <th style="padding: 10px; text-align: left;">Route</th>
                <th style="padding: 10px; text-align: right;">Profit</th>
                <th style="padding: 10px; text-align: right;">Passengers</th>
            </tr>
            {% for route in route_performance %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">{{ route.route__number }}: {{ route.route__name }}</td>
                <td style="padding: 10px; text-align: right; color: {% if route.total_profit > 0 %}green{% else %}red{% endif %};">
                    ‚Çπ{{ route.total_profit|floatformat:2 }}
                </td>
                <td style="padding: 10px; text-align: right;">{{ route.total_passengers }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Top Buses -->
    <div class="card">
        <h2>üöå Top Performing Buses</h2>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="background-color: #f5f5f5;">
                <th style="padding: 10px; text-align: left;">Bus</th>
                <th style="padding: 10px; text-align: right;">Profit</th>
                <th style="padding: 10px; text-align: right;">Routes</th>
            </tr>
            {% for bus in bus_performance %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">{{ bus.bus__number_plate }}</td>
                <td style="padding: 10px; text-align: right; color: {% if bus.total_profit > 0 %}green{% else %}red{% endif %};">
                    ‚Çπ{{ bus.total_profit|floatformat:2 }}
                </td>
                <td style="padding: 10px; text-align: right;">{{ bus.total_routes }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

<!-- Detailed Performance Table -->
<div class="card" style="margin-top: 30px;">
    <h2>üìã Detailed Weekly Performance</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <tr style="background-color: #f5f5f5;">
            <th style="padding: 10px; text-align: left;">Bus</th>
            <th style="padding: 10px; text-align: left;">Route</th>
            <th style="padding: 10px; text-align: right;">Passengers</th>
            <th style="padding: 10px; text-align: right;">KMs</th>
            <th style="padding: 10px; text-align: right;">Revenue</th>
            <th style="padding: 10px; text-align: right;">Cost</th>
            <th style="padding: 10px; text-align: right;">Profit</th>
        </tr>
        {% for performance in performances %}
        <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 10px;">{{ performance.bus.number_plate }}</td>
            <td style="padding: 10px;">{{ performance.route.number }}</td>
            <td style="padding: 10px; text-align: right;">{{ performance.total_passengers }}</td>
            <td style="padding: 10px; text-align: right;">{{ performance.total_kms|floatformat:1 }}</td>
            <td style="padding: 10px; text-align: right;">‚Çπ{{ performance.total_revenue|floatformat:2 }}</td>
            <td style="padding: 10px; text-align: right;">‚Çπ{{ performance.total_cost|floatformat:2 }}</td>
            <td style="padding: 10px; text-align: right; color: {% if performance.total_profit > 0 %}green{% else %}red{% endif %};">
                ‚Çπ{{ performance.total_profit|floatformat:2 }}
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %}