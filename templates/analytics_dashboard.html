{% extends 'base.html' %}

{% block content %}
<h1>ğŸ“Š Analytics Dashboard</h1>
<p>Data insights from the last 8 weeks</p>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
    
    <!-- Weekly Trends -->
    <div class="card">
        <h2>ğŸ“ˆ Weekly Trends</h2>
        <table style="width: 100%;">
            <tr style="background-color: #f5f5f5;">
                <th>Week</th>
                <th>Profit</th>
                <th>Passengers</th>
            </tr>
            {% for trend in weekly_trends %}
            <tr>
                <td>{{ trend.week_start_date }}</td>
                <td>â‚¹{{ trend.total_profit|floatformat:2 }}</td>
                <td>{{ trend.total_passengers }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    
    <!-- Top Routes -->
    <div class="card">
        <h2>ğŸ† Top Routes</h2>
        <table style="width: 100%;">
            <tr style="background-color: #f5f5f5;">
                <th>Route</th>
                <th>Profit</th>
                <th>Profit/km</th>
            </tr>
            {% for route in route_performance %}
            <tr>
                <td>{{ route.route__number }}</td>
                <td>â‚¹{{ route.total_profit|floatformat:2 }}</td>
                <td>â‚¹{{ route.profit_per_km|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    
    <!-- Bus Efficiency -->
    <div class="card">
        <h2>ğŸšŒ Most Efficient Buses</h2>
        <table style="width: 100%;">
            <tr style="background-color: #f5f5f5;">
                <th>Bus</th>
                <th>Revenue/km</th>
                <th>Passengers</th>
            </tr>
            {% for bus in bus_efficiency %}
            <tr>
                <td>{{ bus.bus__number_plate }}</td>
                <td>â‚¹{{ bus.revenue_per_km|floatformat:2 }}</td>
                <td>{{ bus.total_passengers }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    
    <!-- Demand Patterns -->
    <div class="card">
        <h2>ğŸ•’ Demand Patterns</h2>
        <table style="width: 100%;">
            <tr style="background-color: #f5f5f5;">
                <th>Day</th>
                <th>Hour</th>
                <th>Demand</th>
            </tr>
            {% for demand in demand_patterns %}
            <tr>
                <!-- In the Demand Patterns table -->
<td>
    {% if demand.day_of_week == 1 %}Monday
    {% elif demand.day_of_week == 2 %}Tuesday
    {% elif demand.day_of_week == 3 %}Wednesday
    {% elif demand.day_of_week == 4 %}Thursday
    {% elif demand.day_of_week == 5 %}Friday
    {% elif demand.day_of_week == 6 %}Saturday
    {% else %}Sunday{% endif %}
</td>
                <td>{{ demand.hour }}:00</td>
                <td>{{ demand.demand_count }} requests</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

{% endblock %}